- name: Update Compose
  hosts: all
  user: root
  environment:
    HOST: bull.simonknott.de
    LETSENCRYPT_EMAIL: simoknott@gmail.com
  tasks:
    - name: Deploy
      docker_service:
        project_name: Entschuldigungsverfahren
        definition:
          version: '2'
          services:
            mongodb:
              image: mongo:latest
              volumes:
                - "/data/db"
            api:
              build: ./api/Dockerfile
              restart: always
              depends_on:
                - mongodb
              environment:
                - VIRTUAL_HOST=api.bull.simonknott.de
            ui:
              build: ./ui
              restart: always
              environment:
                - VIRTUAL_HOST=bull.simonknott.de
            nginx-proxy:
              image: jwilder/nginx-proxy
              ports:
                - 80:80
                - 443:443
              volumes:
                - "/etc/nginx/vhost.d"
                - "/usr/share/nginx/html"
                - "/var/run/docker.sock:/tmp/docker.sock:ro"
                - "/etc/nginx/certs"

